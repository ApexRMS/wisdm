<?xml version="1.0" encoding="utf-8"?>
<package name="wisdm" displayName="Workbench for Integrated Species Distribution Modeling" version="1.0.0">
	<transformers>
		<!--Primary Transformer-->
		<transformer 
			name="Primary" isPrimary="True" isPipelineBased="True">
		<include>
			<transformer name="corestime_Runtime"/>
			<transformer name="Global"/>
			<transformer name="PrepMultiprocessing"/>
			<transformer name="DataPreparation"/>
			<transformer name="VariableReduction"/>
			<transformer name="GLM"/>
			<transformer name="RandomForest"/>
			<transformer name="ApplyModel"/>
		</include>
		</transformer>
	   <!--Global Transformer-->
		<transformer name="Global">
			<datafeeds>
			<!--Run Control-->
				<datafeed name="RunControl" displayName="Run Control" dataScope="Scenario">
					<datasheets>
						<datasheet name="RunControl" displayName="Run Control" isSingleRow="True">
							<columns>
								<column name="RunControlID" dataType="Integer" isPrimary="True"/>
								<column name="ScenarioID" dataType="Integer"/>
								<column	name="MinimumIteration" dataType="Integer" defaultValue="1" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="1"/>
								<column	name="MaximumIteration"	dataType="Integer" defaultValue="2" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="2"/>
								<column	name="MinimumTimestep" dataType="Integer" defaultValue="0" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="0"/>
								<column	name="MaximumTimestep" dataType="Integer" defaultValue="1" validationType="WholeNumber" validationCondition="GreaterEqual" formula1="1"/>
							</columns>
						</datasheet>
					</datasheets>
				</datafeed>
				<datafeed name="Covariates" dataScope="Project">
				  <datasheets>
					<datasheet name="Covariates" valueMember="CovariatesID" displayMember="CovariateName">
					  <columns>
						<column name="CovariatesID" dataType="Integer" isPrimary="True"/>
						<column name="ProjectID" dataType="Integer"/>
						<column name="CovariateName" displayName="Covariate Name" dataType="String"/>
						<column name="IsCategorical" displayName="Is Categorical" dataType="Boolean" defaultValue="0" isOptional="True"/>
						<column name="Description" dataType="String" isOptional="True"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="FieldData" displayName="Field Data" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="FieldData" displayName="Field Data">
					  <columns>
						<column name="FieldDataID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="SiteID" displayName="Site" dataType="Integer"/>
						<column name="X" dataType="Double"/>
						<column name="Y" dataType="Double"/>
						<column name="Response" dataType="Integer"/>
						<column name="UseInModelEvaluation" displayName="Use In Model Evaluation" dataType="Boolean" defaultValue="0" isOptional="True"/>
						<column name="ModelSelectionSplit" displayName="Model Selection Split" dataType="Integer" isOptional="True"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="CovariateData" displayName="Covariate Data" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="CovariateData" displayName="Covariate Data">
					  <columns>
						<column name="CovariateDataID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="CovariatesID" displayName="Covariate" dataType="Integer" validationType="Datasheet" formula1="Covariates"/>
						<column name="RasterFilePath" displayName="Raster File" dataType="String" isExternalFile="True" isRaster="True"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="ReducedCovariates" displayName="Reduced Covariate List" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="ReducedCovariates" displayName="Reduced Covariate List">
					  <columns>
						<column name="ReducedCovariatesID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="CovariatesID" displayName="Covariate" dataType="Integer" validationType="Datasheet" formula1="Covariates"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="SiteData" displayName="Site Data" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="SiteData" displayName="Site Data">
					  <columns>
						<column name="SiteDataID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="SiteID" displayName="Site" dataType="Integer"/>
						<column name="CovariatesID" displayName="Covariate" dataType="Integer" validationType="Datasheet" formula1="Covariates"/>
						<column name="Value" dataType="Double"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="CovariateSelectionOptions" displayName="Covariate Selection Options" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="CovariateSelectionOptions" displayName="Covariate Selection Options" isSingleRow="True">
					  <columns>
						<column name="CovariateSelectionOptionsID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="DisplayHighestCorrelations" displayName="Display Highest Correlations" dataType="Boolean" defaultValue="-1"/>
						<column name="CorrelationThreshold" displayName="Correlation Threshold" dataType="Double" defaultValue="0.7" validationType="Decimal" validationCondition="Between" formula1="0"  formula2="1"/>
						<column name="NumberOfPlots" displayName="Number of Plots" dataType="Integer" defaultValue="10"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="ValidationOptions" displayName="Validation Options" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="ValidationOptions" displayName="Validation Options" isSingleRow="True">
					  <columns>
						<column name="ValidationOptionsID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="SplitData" displayName="Split data for model training and testing" dataType="Boolean"/>
						<column name="ProportionTrainingData" displayName="Proportion of data used for model training" dataType="Double" validationType="Decimal" validationCondition="Between" formula1="0" formula2="1"/>
						<column name="CrossValidate" displayName="Use cross validation for model selection" dataType="Boolean"/>
						<column name="StratifyFolds" displayName="Stratify cross-validation folds by the response" dataType="Boolean"/>
						<column name="NumberOfFolds" displayName="Number of cross-validation folds" dataType="Integer"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>	
				<datafeed name="TemplateRaster" displayName="Template Raster" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="TemplateRaster" displayName="Template Raster" isSingleRow="True">
					  <columns>
						<column name="TemplateRasterID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="RasterFilePath" displayName="Raster File" dataType="String" isExternalFile="True" isRaster="True"/>
						<column name="TileCount" displayName="Number of Mulitprocessing Tiles (optional)" dataType="Integer"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="OutputOptions" displayName="Output Options" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="OutputOptions" displayName="Output Options" isSingleRow="True">
					  <columns>
						<column name="OutputOptionsID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="MakeProbabilityMap" displayName="Make Probability Map" dataType="Boolean"/>
						<column name="MakeResidualsMap" displayName="Make Residuals Map" dataType="Boolean"/>
						<column name="MakeMessMap" displayName="Make Multivariate Environmental Similarity Surface (MESS) Map" dataType="Boolean"/>
						<column name="MakeModMap" displayName="Make Mod Map" dataType="Boolean"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
				<datafeed name="ModelOutputs" dataScope="Scenario" isOutput="True">
				  <datasheets>
					<datasheet name="ModelOutputs">
					  <columns>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="ModelType" dataType= "String"/>
						<column name="ModelRDS" dataType="String" isExternalFile="True"/>
						<column name="ResponseCurves" dataType="String" isExternalFile="True"/>
						<column name="ResidualsPlot" dataType="String" isExternalFile="True"/>
						<column name="ResidualSmoothPlot" dataType="String" isExternalFile="True"/>
						<column name="ResidualSmoothRDS" dataType="String" isExternalFile="True"/>
						<column name="TextOutput" dataType="String" isExternalFile="True"/>
						<column name="CalibrationPlot" dataType="String" isExternalFile="True"/>
						<column name="ROCAUCPlot" dataType="String" isExternalFile="True"/>
						<column name="AUCPRPlot" dataType="String" isExternalFile="True"/>
						<column name="ConfusionMatrix" dataType="String" isExternalFile="True"/>
						<column name="VariableImportancePlot" dataType="String" isExternalFile="True"/>
						<column name="VariableImportanceData" dataType="String" isExternalFile="True"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>	
			</datafeeds>
		</transformer>
		<!--Prepare Multiprocessing Transformer-->
		<transformer
		  name="PrepMultiprocessing"
		  displayName ="1 - Prepare Multiprocessing"
		  isRunnable="True"
		  programName="RScript"
		  programArguments="1-prep-multiprocessing.R"
		  runContext="LocalOnly">
			<pipeline>
				<datafeed name="RunControl"/>
				<datafeed name="TemplateRaster" type="Input"/>
			</pipeline>
		</transformer>	
		<!--Data Preparation Transformer-->
		<transformer
		  name="DataPreparation"
		  displayName ="1 - Data Preparation"
		  isRunnable="True"
		  programName="RScript"
		  programArguments="1-data-preparation.R"
		  transformerSpecificOutput="False">
		  <pipeline>
			<datafeed name="FieldData" type="Input"/>
			<datafeed name="CovariateData" type="Input"/>
			<datafeed name="ValidationOptions" type="Input"/>
			<datafeed name="SiteData" type="Output"/>
		  </pipeline>
		</transformer>
		<!--Variable Reduction Transformer-->
		<transformer
		  name="VariableReduction"
		  displayName ="2 - Variable Reduction"
		  isRunnable="True"
		  programName="RScript"
		  programArguments="2-variable-reduction.R"
		  transformerSpecificOutput="False">
			<pipeline>
				<datafeed name="FieldData" type="Input"/>
				<datafeed name="CovariateData" type="Input"/>
				<datafeed name="SiteData" type="Input"/>
				<datafeed name="CovariateSelectionOptions" type ="Input"/>
				<datafeed name="CovariateCorrelationMatrix" type="Output"/>
				<datafeed name="ReducedCovariates" type="Output"/>
			</pipeline>
			<datafeeds>
				<datafeed name="CovariateCorrelationMatrix" dataScope="Scenario" isOutput="True">
				  <datasheets>
					<datasheet name="CovariateCorrelationMatrix">
					  <columns>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="Filename" displayName="Covariate Correlation Matrix" dataType="String" isExternalFile="True"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
			</datafeeds>
		</transformer>
		<!--GLM Transformer-->
		<transformer
		  name="GLM"
		  displayName ="3 - Generalized Linear Model"
		  isRunnable="True"
		  programName="RScript"
		  programArguments="3-fit-glm.R"
		  transformerSpecificOutput="False">
			<pipeline>
				<datafeed name="FieldData" type="Input"/>
				<datafeed name="ValidationOptions" type="Input"/>
				<datafeed name="ReducedCovariates" type="Input"/>
				<datafeed name="SiteData" type="Input"/>
				<datafeed name="GLM" dataScope="Input"/>
				<datafeed name="ModelOutputs" type="Output"/>
			</pipeline>	
			<datafeeds>
				<datafeed name="GLM" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="GLM" isSingleRow="True">
					  <columns>
						<column name="GLMID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="SelectBestPredictors" displayName="Select Best Predictors" dataType="Boolean"/>
						<column name="SimplificationMethod" displayName="Simplification Method" dataType="Integer" validationType="List" formula1="0:AIC|1:BIC"/>
						<column name="ConsiderSquaredTerms" displayName="Consider Squared Terms" dataType="Boolean"/>
						<column name="ConsiderInteractions" displayName="Consider Interactions" dataType="Boolean"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>		
			</datafeeds>
		</transformer>
		<!--Random Forest Transformer-->
		<transformer
		  name="RandomForest"
		  displayName ="3 - Random Forest"
		  isRunnable="True"
		  programName="RScript"
		  programArguments="3-fit-random-forest.R"
		  transformerSpecificOutput="False">
			<pipeline>
				<datafeed name="FieldData" type="Input"/>
				<datafeed name="ValidationOptions" type="Input"/>
				<datafeed name="ReducedCovariates" type="Input"/>
				<datafeed name="SiteData" type="Input"/>
				<datafeed name="ModelOutputs" type="Output"/>
			</pipeline>
			<datafeeds>
				<datafeed name="RandomForest" displayName="Random Forest" dataScope="Scenario">
				  <datasheets>
					<datasheet  name="RandomForest" displayName="Random Forest" isSingleRow="True">
					  <columns>
						<column name="RandomForestID" dataType="Integer" isPrimary="True"/>
						<column name="ScenarioID" dataType="Integer"/>
						<column name="EvaluateCovariateImportance" displayName="Evaluate Covariate Importance" dataType="Boolean"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
			</datafeeds>
		</transformer>
		<!--Apply Model Transformer-->
		<transformer
		  name="ApplyModel"
		  displayName ="4 - Apply Model"
		  isRunnable="True"
		  programName="RScript"
		  programArguments="4-apply-model.R"
		  className="SyncroSim.StochasticTime.StochasticTimeTransformer" 
		  classAssembly="SyncroSim.StochasticTime"
		  configurationSheet="RunControl"
		  runContext="AllowRemote">
			<pipeline>
				<datafeed name="RunControl"/>
				<datafeed name="corestime_Multiprocessing" type="Input"/>
				<datafeed name="TemplateRaster" type="Input"/>
				<datafeed name="ModelOutputs" type="Input"/>
				<datafeed name="CovariateData" type="Input"/>
				<datafeed name="OutputOptions" type="Input"/>
				<datafeed name="SpatialOutputs" type="Output"/>
			</pipeline>
			<datafeeds>			
				<datafeed name="SpatialOutputs" dataScope="Scenario" isOutput="True">
				  <datasheets>
					<datasheet name="SpatialOutputs" spatialMultiProcessing="True">
					  <columns>
					  	<column name="ScenarioID" dataType="Integer"/>
						<column name="Iteration" dataType= "Integer"/>
						<column name="Timestep" dataType= "Integer"/>
						<column name="ModelType" dataType= "String"/>
						<column name="ProbabilityRaster" dataType="String" isExternalFile="True" isRaster="True" bandColumn="Band"/>
						<column name="MessRaster" dataType="String" isExternalFile="True" isRaster="True" bandColumn="Band"/>
						<column name="ModRaster" dataType="String" isExternalFile="True" isRaster="True" bandColumn="Band"/>
						<column name="ResidualsRaster" dataType="String" isExternalFile="True" isRaster="True" bandColumn="Band"/>
						<column name="Band" dataType="Integer" allowDbNull="True" isOptional="True"/>
					  </columns>
					</datasheet>
				  </datasheets>
				</datafeed>
			</datafeeds>
		</transformer>
		 <!--Export Transformers-->
		<transformer
		  name="CovariateCorrelationExportMatrix" displayName="Covariate Correlation" dataSheet="CovariateCorrelationMatrix" column="Filename" isFolderExport="True" >
		</transformer>
		<transformer 
		name="ModelExportRDS" displayName="Model" dataSheet="ModelOutputs" column="ModelRDS" isFolderExport="True">
		</transformer>
		<transformer 
		name="ModelExportText" dataSheet="ModelOutputs" column="TextOutput" isFolderExport="True">
		</transformer>
		<transformer 
		name="VariableImportanceExportData" dataSheet="ModelOutputs" column="VariableImportanceData">
		</transformer>
	</transformers>
	<layouts>
		<!--Library Datafeeds Layout-->
		<layout name="coreforms_LibraryDatafeeds">
		  <item name="core_Rconfig"/>
		</layout>  
		<!--Project Datafeeds Layout-->
		<layout name="coreforms_ProjectDatafeeds">
		  <item name="Covariates"/>
		</layout> 
		<!--Scenario Datafeeds Layout-->
		<layout name="coreforms_ScenarioDatafeeds">
		  <group name="DataPreparation" displayName="Data Preparation">
			<item name="FieldData"/>
			<item name="CovariateData"/>
			<item name="ValidationOptions"/>
			<item name="TemplateRaster"/>
			<item name="corestime_Multiprocessing"/>
		  </group>
		  <group name="VariableReduction" displayName="Variable Reduction">
			<item name="CovariateSelectionOptions"/>
			<item name="SiteData"/>
			<item name="ReducedCovariates"/>
		  </group>
		  <group name="Models">
			<item name="GLM"/>
			<item name="RandomForest"/>
		  </group>
		<item name="OutputOptions"/>
		</layout> 
		<!--Result Transformers Layout-->
		<layout name="coreforms_ResultTransformers">
			<item name="corestime_MapTransformer"/>
			<group name="Export">
				<item name="CovariateCorrelationExportMatrix" displayName="Covariate Correlation Matrix"/>
				<group name="ModelOutputs" displayName="Model Outputs">
					<item name="ModelExportRDS" displayName="Model RDS"/>
					<item name="ModelExportText" displayName="Summary Text"/>
					<item name="VariableImportanceExportData" displayName="Variable Importance"/>
				</group>
			</group>
        </layout>
		<!--Maps Layout-->
		<layout name="corestimeforms_Maps" configurationSheet="RunControl">
			<item name="ProbabilityMap" displayName="Probability Map" dataSheet="SpatialOutputs" column="ProbabilityRaster"/>
			<item name="MessMap" displayName="MESS Map" dataSheet="SpatialOutputs" column="MessRaster"/>
			<item name="ModMap" displayName="Mod Map" dataSheet="SpatialOutputs" column="ModRaster"/>
		</layout>
	</layouts>	
</package>